Description: >
  DynamoDB table dengan primary key (hash key dan range key).

#----------------------------------------------------------------------------------------#
Metadata:
  AWS::CloudFormation::Interface:
    ParameterGroups:
    - Label:
        default: Partition Key (Hash Key)
      Parameters: [HashKey, HashKeyType]
    - Label:
        default: Sort Key (Range Key)
      Parameters: [RangeKey, RangeKeyType]
    - Label:
        default: RCU/WCU
      Parameters: [ReadCapacityUnits, WriteCapacityUnits]

    ParameterLabels:
      HashKey:
        default: Name of hash key.
      HashKeyType:
        default: Type of hash key. Input string (S), or number (N).
      RangeKey:
        default: Name of range key.
      RangeKeyType:
        default: Type of range key. Input string (S), or number (N).
      ReadCapacityUnits:
        default: Provision Read Capacity Units (1 RCU is 4KB/s throughput for read).
      WriteCapacityUnits:
        default: Provision Write Capacity Units (1 WCU is 1KB/s throughput for write).

#----------------------------------------------------------------------------------------#
Parameters:
  HashKey:
    Type: String
    AllowedPattern: "[a-zA-Z0-9]*"
    MinLength: 1
    MaxLength: 2048
    ConstraintDescription: Must contain only alphanumberic characters.

  HashKeyType:
    Type: String
    Default: S
    AllowedPattern: "[S|N]"
    ConstraintDescription: Must be either S, or N.

  RangeKey:
    Type: String
    AllowedPattern: "[a-zA-Z0-9]*"
    MinLength: 1
    MaxLength: 2048
    ConstraintDescription: Must contain only alphanumberic characters.
 
  RangeKeyType:
    Type: String
    Default: S
    AllowedPattern: "[S|N]"
    ConstraintDescription: Must be either S, or N.

  ReadCapacityUnits:
    Type: Number
    Default: 5
    MinValue: 5
    MaxValue: 10000
    ConstraintDescription: Must be between 5 and 10000.

  WriteCapacityUnits:
    Type: Number
    Default: 10
    MinValue: 5
    MaxValue: 10000
    ConstraintDescription: Must be between 5 and 10000.

#----------------------------------------------------------------------------------------#
Resources:
  DynamoDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      AttributeDefinitions:
      - AttributeName:
          Ref: HashKey
        AttributeType:
          Ref: HashKeyType
      - AttributeName:
          Ref: RangeKey
        AttributeType:
          Ref: RangeKeyType
      KeySchema:
      - AttributeName:
          Ref: HashKey
        KeyType: HASH
      - AttributeName:
          Ref: RangeKey
        KeyType: RANGE
      ProvisionedThroughput:
        ReadCapacityUnits:
          Ref: ReadCapacityUnits
        WriteCapacityUnits:
          Ref: WriteCapacityUnits

#----------------------------------------------------------------------------------------#
Outputs:
  TableARN:
    Value:
      Fn::GetAtt: DynamoDBTable.Arn
    Description: ARN of the created DynamoDB table