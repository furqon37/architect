Description: >
  AutoScaling Linux EC2 with ALB.

#----------------------------------------------------------------------------------------#
Parameters:
  InstanceType:
    Type: String
    Default: t3.micro
    AllowedValues:
      - t3.micro
      - t3a.small
      - t3a.medium
    Description: Select instance type for EC2 instance. The default value is t3.micro.

  FirstEC2SubnetID:
    Type: AWS::EC2::Subnet::Id
    Description: Select the first Subnet ID where the EC2 instances.
  SecondEC2SubnetID:
    Type: AWS::EC2::Subnet::Id
    Description: Select the second Subnet ID where the EC2 instances.
  VPCID:
    Type: AWS::EC2::VPC::Id
    Description: Select the VPC ID.
  SecurityGroupID:
    Type: AWS::EC2::SecurityGroup::Id
    Description: Select existing SecurityGroup for EC2 instance.

#----------------------------------------------------------------------------------------#
Resources:
  AutoScalingGroup:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://furqonmauladani.s3.amazonaws.com/7.1-autoscaling.yaml
      Parameters:
        InstanceType:
          Ref: InstanceType
        ElasticLoadBalancer:
          Fn::GetAtt: [ApplicationLoadBalancer,Outputs.ApplicationLoadBalancerID]
        FirstEC2SubnetID:
          Ref: FirstEC2SubnetID
        SecondEC2SubnetID:
          Ref: SecondEC2SubnetID      
        SecurityGroupID:
          Ref: SecurityGroupID

  ApplicationLoadBalancer:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://furqonmauladani.s3.amazonaws.com/6.3-alb.yaml
      Parameters:
        FirstEC2SubnetID:
          Ref: FirstEC2SubnetID
        SecondEC2SubnetID:
          Ref: SecondEC2SubnetID      
        VPCID:
          Ref: VPCID


#----------------------------------------------------------------------------------------#
Outputs:
  WebsiteURL:
    Value:
      Fn::GetAtt: [ApplicationLoadBalancer,Outputs.URL]
    Description: URL of the website